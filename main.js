(()=>{"use strict";class e{constructor(e,t){this.name=e,this.length=t,this.orientation="horizontal",this.hits=[]}hit(e){this.hits.push(e)}isSunk(){if(this.hits.length===this.length)return!0}changeOrientation(){return"horizontal"===this.orientation?this.orientation="vertical":this.orientation="horizontal"}}class t{appendCells(e,t,n){return`<div class="cell ${n}" data-row="${e}" data-col="${t}" ></div>`}appendPieces(e){return`<div id="${e}" class="${e}-horizontal docked" data-type="${e}" draggable="true"></div>`}renderPieces(e,t){let n=this.appendPieces(t.name);e.innerHTML+=n}renderBoard(e,t){this.resetBoard(e);let n="";for(let e=0;e<t.board.length;e++)for(let i=0;i<t.board.length;i++){let r=t.board[e][i];null===r?r="":null!==r&&"object"==typeof r&&(r="human"===t.owner?`${r.name} player-${r.name}`:`${r.name} computer-${r.name}`),n+=this.appendCells(e,i,r)}e.insertAdjacentHTML("afterbegin",n)}resetBoard(e){e.textContent=""}newFleet(){return[new e("carrier",5),new e("battleship",4),new e("destroyer",3),new e("cruiser",3),new e("submarine",2)]}}class n{constructor(e){this.owner=e,this.board=[],this.fleet=[],this.bucket=[],this.loser=!1}generateBoard(){for(let e=0;e<10;e++)this.board[e]=new Array(10).fill(null);return this.board}fillBucket(e){this.bucket.includes(e)||this.bucket.push(e)}assembleFleet(e){this.fleet.includes(e)||this.fleet.push(e)}placeShip(e,t,n){let i=this.bucket.indexOf(e);if(!this.isLegal(e,t,n))return!1;if("horizontal"===e.orientation){this.assembleFleet(e);for(let i=0;i<e.length;i++)this.board[t][n+i]=e}else{this.assembleFleet(e);for(let i=0;i<e.length;i++)this.board[t+i][n]=e}return this.bucket.splice(i,1),!0}random(){return Math.floor(10*Math.random())}randomOrientation(e){const t=Math.random()<.5;for(let n=0;n<this.fleet.length;n++)t&&e.changeOrientation()}computerPlacement(){const e=this.random(),t=this.random();for(let n=0;n<this.bucket.length;n++){if(this.randomOrientation(this.bucket[n]),0===this.bucket.length)return;if(this.isLegal(this.bucket[n],e,t)){if("horizontal"===this.bucket[n].orientation&&this.isLegal(this.bucket[n],e,t))for(let i=0;i<this.bucket[n].length;i++)this.board[e][t+i]=this.bucket[n];else if("vertical"===this.bucket[n].orientation&&this.isLegal(this.bucket[n],e,t))for(let i=0;i<this.bucket[n].length;i++)this.board[e+i][t]=this.bucket[n]}else this.computerPlacement();this.bucket.shift(),this.computerPlacement()}}isLegal(e,t,n){if(t<0||t>9||n<0||n>9)return!1;if("horizontal"===e.orientation){if(n+e.length>9)return!1;for(let i=0;i<e.length;i++)if(this.board[t][n+i])return!1}else if("vertical"===e.orientation){if(t+e.length>9)return!1;for(let i=0;i<e.length;i++)if(this.board[t+i][n])return!1}return!0}receiveAttack(e,t){if("hit"!==this.board[e][t]&&"miss"!==this.board[e][t])if(null===this.board[e][t])this.board[e][t]="miss";else{for(let n=0;n<this.fleet.length;n++)this.board[e][t].name===this.fleet[n].name&&this.fleet[n].hit("hit");this.board[e][t]="hit"}}gameOver(){return this.loser=this.fleet.every((e=>e.isSunk()))}}class i{constructor(e){this.name=e}attack(e,t,n){e.receiveAttack(t,n)}random(){return Math.floor(10*Math.random())}computerAttack(e){const t=this.random(),n=this.random(),i=e.board[t][n];"hit"===i||"miss"===i?this.computerAttack(e):e.receiveAttack(t,n)}}const r=document.getElementById("player-container"),s=document.getElementById("computer-container"),l=new t,o=new i("human"),a=new n("human"),c=new i("computer"),d=new n("computer"),h=document.getElementById("ship-select"),u=((e,n)=>{const i=new t;let r;function s(e){r=e.target,console.log("start")}function l(e){e.preventDefault(),console.log("over")}function o(e){e.preventDefault(),console.log("enter")}function a(){console.log("leave")}function c(){console.log("end")}function d(t){const s=t.target,l=function(){for(let t=0;t<e.bucket.length;t++)if(e.bucket[t].name===r.dataset.type)return e.bucket[t]}(),o=Number(s.dataset.row),a=Number(s.dataset.col);e.placeShip(l,o,a)&&(e.placeShip(l,o,a),i.renderBoard(n,e),h(),r.parentElement.removeChild(r))}function h(){const e=document.querySelectorAll(".docked"),t=n.childNodes;for(const t of e)t.addEventListener("dragstart",s),t.addEventListener("dragend",c);for(const e of t)e.addEventListener("dragover",l),e.addEventListener("dragenter",o),e.addEventListener("dragleave",a),e.addEventListener("drop",d)}return{combineEvents:h}})(a,r);window.addEventListener("DOMContentLoaded",(()=>{const e=l.newFleet(),t=l.newFleet();a.generateBoard(),d.generateBoard();for(let t=0;t<e.length;t++)d.fillBucket(e[t]),d.assembleFleet(e[t]);for(let e=0;e<t.length;e++)a.fillBucket(t[e]);for(let e=0;e<a.bucket.length;e++)l.renderPieces(h,a.bucket[e]);d.computerPlacement(),l.renderBoard(r,a),l.renderBoard(s,d),u.combineEvents()}));const m=document.getElementById("start"),b=document.getElementById("flip");m.addEventListener("click",(()=>{a.bucket.length<=0&&(s.style.visibility="visible",b.style.visibility="hidden",m.style.visibility="hidden")})),b.addEventListener("click",(()=>{const e=Array.from(h.children);for(let t=0;t<e.length;t++)a.bucket[t].changeOrientation(),e[t].classList.contains("docked")&&(e[t].classList.toggle(`${a.bucket[t].name}-horizontal`),e[t].classList.toggle(`${a.bucket[t].name}-vertical`))})),document.getElementById("restart").addEventListener("click",(()=>{const e=l.newFleet(),t=l.newFleet();a.fleet=[],d.fleet=[],a.generateBoard(),d.generateBoard();for(let t=0;t<e.length;t++)d.fillBucket(e[t]),d.assembleFleet(e[t]);for(let e=0;e<t.length;e++)a.fillBucket(t[e]);for(let e=0;e<a.bucket.length;e++)l.renderPieces(h,a.bucket[e]);d.computerPlacement(),l.renderBoard(r,a),l.renderBoard(s,d),u.combineEvents(),document.getElementById("result").style.visibility="hidden",m.style.visibility="visible",b.style.visibility="visible"})),s.addEventListener("click",(e=>{const t=e.target,n=t.dataset.row,i=t.dataset.col,s=document.getElementById("result"),h=document.getElementById("winner");console.log(d.fleet),t.classList.contains("hit")||t.classList.contains("miss")||(o.attack(d,n,i),"miss"===d.board[n][i]?t.classList.add("miss"):t.classList.add("hit"),c.computerAttack(a),l.renderBoard(r,a),!0===d.gameOver()&&(s.style.visibility="visible",h.textContent="You won!"),!0===a.gameOver()&&(s.style.visibility="visible",h.textContent="You lose..."))}))})();
//# sourceMappingURL=main.js.map